import{w as M,r as s,j as t}from"./chunk-OIYGIGL5-B6SvBvvm.js";import{u as P}from"./header-context-BPywMii-.js";import{C as T,u as U}from"./constants-context-H2NxbeDZ.js";import{s as z,g as V}from"./register_all_kernels-Cy_UnWz8.js";const h="OpenVINO MobileNet-SSD pretrained object detection model + face 68 landmark, recognition and expression models.";function H({}){return[{title:`Vision | ${T.TITLES.FACIAL_EXPRESSIONS} | ${h}`},{name:"description",content:h}]}const q=M(function(){const{setTitle:w,setDescription:v}=P(),{TITLES:E}=U();s.useEffect(()=>{w(E.FACIAL_EXPRESSIONS),v(h)},[w,v,E.FACIAL_EXPRESSIONS]);const n=s.useRef(null),i=s.useRef(null),c=s.useRef(null),d=s.useRef(null),[f,g]=s.useState([]),[l,y]=s.useState(!1),[R,C]=s.useState(!1),I=e=>e.charAt(0).toUpperCase()+e.slice(1),k=async()=>{try{d.current=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),n.current&&(n.current.srcObject=d.current)}catch(e){console.error(e)}};s.useEffect(()=>{const e=document.createElement("script");return e.src="/face-api.js",e.defer=!0,e.onload=()=>{y(!0)},document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),s.useEffect(()=>{if(!l||!n.current||!i.current||!c.current)return;(async()=>{try{await Promise.all([window.faceapi.nets.ssdMobilenetv1.loadFromUri("/models"),window.faceapi.nets.faceLandmark68Net.loadFromUri("/models"),window.faceapi.nets.faceRecognitionNet.loadFromUri("/models"),window.faceapi.nets.faceExpressionNet.loadFromUri("/models")]),await k(),C(!0)}catch(r){console.error("Error loading models:",r)}})()},[l]);const p=s.useRef(void 0);return s.useEffect(()=>{if(!l||!n.current||!i.current||!c.current)return;const e=n.current;i.current;const r=c.current,o=async()=>{const a=window.faceapi.createCanvasFromMedia(e);return a.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,a.width,a.height),r.append(a),p.current=setInterval(async()=>{const j={width:r.offsetWidth,height:r.offsetHeight};window.faceapi.matchDimensions(a,j);const N=await window.faceapi.detectAllFaces(e).withFaceLandmarks().withFaceDescriptors().withFaceExpressions(),F=window.faceapi.resizeResults(N,j);if(N.length===0)g([]);else{const A=F.map(m=>{let u=[],S="",L=0;for(const[D,O]of Object.entries(m.expressions)){const b=I(D),x=Math.round(O*100);u.push({expressionName:b,expressionValue:x}),x>L&&(L=x,S=b)}return{title:S,data:u}});g(A),F.forEach(m=>{const u=new window.faceapi.draw.DrawFaceLandmarksOptions({drawPoints:!0,pointSize:2,pointColor:"white",drawLines:!0,lineColor:"white",lineWidth:1});new window.faceapi.draw.DrawFaceLandmarks(m.landmarks,u).draw(a)})}},200),()=>clearInterval(p.current)};return e.addEventListener("play",o),()=>{e.removeEventListener("play",o)}},[l]),s.useEffect(()=>(z("webgl"),console.log(V()),()=>{d.current&&d.current.getTracks().forEach(e=>e.stop()),clearInterval(p.current)}),[]),t.jsxs("div",{className:"ex-app-container",children:[t.jsx("div",{className:"ex-container",children:R?f.length===0?t.jsx("div",{className:"ex-box",children:"Detecting faces ..."}):t.jsxs(t.Fragment,{children:[f.map((e,r)=>t.jsx("div",{className:"ex-box",children:t.jsx("table",{className:"ex-box-data",children:t.jsx("tbody",{children:e.data.map((o,a)=>t.jsx("tr",{children:t.jsx("td",{children:t.jsx("span",{style:o.expressionName===e.title?{fontWeight:"bold",color:"#d70026"}:{},children:`${o.expressionName} ${o.expressionValue}%`})})},a))})})},r)),f.length===1&&t.jsx("div",{className:"ex-box ex-ghost",children:t.jsx("span",{className:"ex-box-person",children:"#2"})})]}):t.jsx("div",{className:"ex-box",children:"Loading models"})}),t.jsxs("div",{id:"ex-video",ref:c,children:[t.jsx("video",{ref:n,width:"100%",autoPlay:!0}),t.jsx("canvas",{ref:i,style:{display:"none"}})]})]})});export{q as default,H as meta};
